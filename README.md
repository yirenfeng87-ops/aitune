# AI 写作助手（MVP）PRD

> 技术栈：Next.js / React / TailwindCSS / shadcn/ui
> 模型调用：OpenRouter（支持 deepseek 与 kimi 免费模型）

---

## 1. 项目概述

### 1.1 产品名称
AI 写作助手（MVP）

### 1.2 背景与问题
用户希望在一个简单页面里输入主题信息与偏好设置，选择不同大模型（通过 OpenRouter），生成可复制的写作内容，用于演示或快速验证产品方向。

### 1.3 目标
- 最短路径跑通：**输入 → 设置 → 调用模型 → 输出结果**
- 支持多模型切换：
  - `deepseek/deepseek-r1-0528:free`
  - `moonshotai/kimi-k2:free`
- 支持高级偏好：语言、语气、角色
- Demo 级可用性：加载态、错误提示、复制结果、基础日志

### 1.4 非目标（MVP 不做）
- 登录/账号体系、历史记录、多文档管理
- 流式输出（可作为下一期）
- 多轮对话、引用资料、联网搜索、图片/文件上传
- 模板市场、提示词可视化编辑器

---

## 2. 用户与使用场景

### 2.1 目标用户
- 内部团队（产品/研发/运营）演示与验证
- 开发者用于快速集成 OpenRouter

### 2.2 核心场景
1. 用户选择模型 → 填写主题关键词与描述 → 设置语言/语气/角色 → 点击生成 → 得到结构化内容（大纲/正文等）
2. 用户更换模型或语气 → 再次生成 → 对比结果差异

### 2.3 扩展场景（进阶）
- 流式生成：长文实时可视化，边看边思考
- 模板写作：选择场景一键套用角色/语气/结构
- 续写与改写：基于已有输出进行增改，逐步打磨
- 导出与分享：生成后直接导出 .txt/.md/.pdf；后续 Word
- 收藏与历史：标记优质内容、从历史恢复继续编辑

---

## 3. 产品范围（MVP）

### 3.1 页面结构（单页）
- 顶部：标题 + 简短说明
- 输入表单区（左侧/上方）
- 输出结果区（右侧/下方）

### 3.2 表单字段

#### 必填
1. **模型选择（Select）**
   - deepseek/deepseek-r1-0528:free
   - moonshotai/kimi-k2:free
2. **主题关键词（Input）**
3. **主题描述（Textarea）**

#### 高级设置（折叠面板 / Accordion）
1. **语言（Select）**
   - 中文（默认）
   - English
   - 日本語（可选）
2. **语气（Select）**
   - 正式（默认）
   - 轻松
   - 专业
   - 说服型
3. **想要扮演的角色（Input / Select + 自定义）**
   - 例：资深文案、产品经理、学术编辑、营销专家
   - 默认：资深写作助手

#### 操作按钮
- 生成（Primary）
- 重置（Secondary）

### 3.3 输出区
- 输出文本显示（MVP 推荐纯文本；可选支持 Markdown 渲染）
- 复制按钮（Copy）
- 状态提示：
  - Loading（调用中）
  - Error（失败原因）
  - Empty（尚未生成）

---

## 4. 交互与流程

### 4.1 核心流程
1. 用户填写必填项
2. 展开高级设置（可选）
3. 点击"生成"
4. 前端调用 Next.js API Route（服务端转发）
5. API Route 调 OpenRouter
6. 返回结果 → 前端展示 → 可复制

### 4.2 表单校验（MVP）
- 模型必选
- 主题关键词非空（建议 2～50 字）
- 主题描述非空（建议 10～1000 字）
- 高级设置可为空（空则使用默认值）

### 4.3 状态与异常处理
- 提交后按钮进入 loading（禁用重复点击）
- 常见错误提示：
  - 401/403：API Key 无效或权限不足
  - 429：请求过多，请稍后再试
  - 5xx：服务暂时不可用
- 超时：请求超时，请重试
- 结果为空：模型未返回内容，请调整描述或重试

---

## 5. 功能需求（MVP）

### 5.1 模型选择
- 下拉选择
- 可选：记忆上次选择（localStorage）
- 可选：静态提示模型风格/速度

### 5.2 Prompt 组织（建议模板）
系统指令（system）+ 用户输入（user）

#### System（示例）
- 你是{角色}，用{语言}输出，整体语气为{语气}。
- 输出要求：结构清晰、可直接复制使用。
- 若信息不足，可合理补全，但不要编造具体事实来源。

#### User（示例）
- 主题关键词：xxx
- 主题描述：xxx
- 任务：基于以上信息生成内容（MVP 固定：文章大纲 + 正文）

#### MVP 固定输出格式（建议）
1. 标题候选 x3
2. 大纲（分点）
3. 正文（约 600～1000 字）
4. 可选：结尾总结 / CTA

### 5.3 调用 OpenRouter（MVP 约定）
- 前端不直接带 Key 调用；通过 Next.js `route.ts` 服务端转发
- 支持切换 `model` 参数
- 记录基础日志（model、耗时、成功/失败；可不记录用户原文或仅记录长度）

### 5.4 复制与导出
- 一键复制输出
- 导出为 .txt 文本文件
- 导出为 .md Markdown 文件
- 导出为 PDF 文件
- 进阶：导出为 Word

### 5.5 流式输出（Streaming）
- 实时逐字显示模型输出，边生成边渲染
- 降低等待焦虑，提前看到部分结果
- 支持开启/关闭流式模式，失败自动回退为一次性输出

### 5.6 内容模板/场景
- 预设常用场景：小红书文案、公众号文章、产品描述、邮件回复等
- 每个场景包含预设角色、语气、输出格式
- 模板可作为 Prompt 片段自动拼接；支持自定义与保存

### 5.7 多轮对话/续写
- 在当前输出基础上继续对话：扩展段落、改写结尾等
- 维护上下文消息列表，支持引用上一轮内容
- 可选：对每次续写保留为独立版本

### 5.8 内容编辑
- 输出区可直接编辑生成内容
- 保存编辑后的版本以便后续续写或导出
- 支持撤销/重做与基本格式（Markdown 兼容）

### 5.9 收藏/标星
- 对满意的结果标记为收藏
- 收藏列表独立查看、删除
- 支持按模型/时间筛选

### 5.10 历史记录
- 自动保存生成历史，支持单条删除与一键清空
- 显示使用模型与关键提示词信息
- 可从历史恢复到编辑/继续对话

### 5.11 内容长度设置
- 提供目标字数/长度设置，限制生成内容规模
- 与 max_tokens 协同：前端提示与后端约束
- 超出限制进行截断或提示调整

---

## 6. 技术实现要求

### 6.1 前端（Next.js + React）
- 推荐 Next.js App Router
- shadcn/ui 组件建议：
  - `Select`, `Input`, `Textarea`, `Button`, `Accordion`, `Card`, `Toast`
- Tailwind 实现响应式：
  - 桌面双栏（输入/输出）
  - 移动端上下布局

### 6.2 服务端（Next.js Route Handler）
- `POST /api/generate`
  - 接收表单内容
  - 拼接 prompt
  - 请求 OpenRouter
  - 返回生成结果
- 使用环境变量存储 `OPENROUTER_API_KEY`
- 可选：轻量限流（MVP 可先不做）

### 6.3 数据存储（MVP）
- 不落库
- localStorage 保存偏好（语言/语气/角色/模型）

### 6.4 进阶技术要点（Streaming/模板/历史等）
- 流式输出：Route Handler 使用可读流（ReadableStream）转发；前端通过 fetch reader 或 SSE 渲染
- 导出：前端使用 Blob 生成 .txt/.md 下载；PDF 已集成第三方库；Word 后续集成
- 模板/场景：静态模板配置 + 自定义模板存储在 localStorage，拼接到 system/user prompt
- 多轮对话：前端维护 messages 列表，服务端透传；设置最大轮次与总长度
- 编辑/版本：输出区内容可编辑，保存版本快照到 localStorage
- 收藏/历史：基于 localStorage 的索引结构；提供清空与单条删除；提示隐私
- 内容长度：前端字数限制与提示；服务端结合 max_tokens 约束

---

## 7. 接口需求（OpenRouter）

### 7.1 请求参数（建议）
- `model`: 下拉选择传入
- `messages`: system + user
- `temperature`: MVP 固定（如 0.7）
- `max_tokens`: MVP 固定（如 1200～2000）

### 7.2 返回处理
- 解析 `choices[0].message.content`（或等价字段）
- 返回给前端：
  - `text`
  - `usage`（可选：token 统计）

### 7.3 进阶参数（可选）
- `stream`: 是否流式输出（SSE/流式文本）
- `messages`: 支持多轮对话，包含上下文与续写请求
- `target_length`: 目标字数/内容长度提示
- `metadata`: 生成场景与偏好标签，便于埋点与历史记录

---

## 8. UI 草图（文字版）

### 8.1 桌面端（两栏）
**输入卡片**
- 模型选择
- 主题关键词
- 主题描述
- 高级设置（语言/语气/角色）
- 生成 / 重置

**输出卡片**
- 标题 + Copy
- 内容区（滚动）
- 状态条（耗时/错误/提示）

### 8.2 移动端（上下）
输入在上，输出在下。

### 8.3 进阶 UI 元素
- 流式进度与逐字动画
- 导出按钮组（TXT/MD/PDF/后续 Word）
- 模板/场景选择下拉与描述
- 编辑开关、保存按钮与版本列表
- 收藏星标与收藏页入口
- 历史列表（卡片样式），支持恢复与删除
- 字数设置（滑块或输入框）

---

## 9. 埋点与可观测性（MVP 轻量）
- 前端（可先 console）：
  - 点击生成、成功/失败、模型切换次数
- 服务端日志：
  - 开始/结束时间、model、status code
  - 可不记录原始输入（或只记录长度）
- 进阶埋点：
  - 流式：开始/结束、失败回退
  - 导出：点击次数、导出格式类型
  - 模板：选择/自定义/应用次数
  - 收藏：新增/删除/查看
  - 历史：生成/恢复/清空
  - 编辑：保存版本次数、字数变化

---

## 10. 安全与合规（MVP 最低要求）
- API Key 仅保存在服务端环境变量
- 前端不暴露 Key
- 错误信息对用户友好；服务端保留详细日志

---

## 11. 验收标准（MVP）
1. 页面可本地启动并正常渲染
2. 可切换两种模型
3. 填写关键词与描述后可生成并展示结果
4. 高级设置会影响输出（语言/语气/角色）
5. 具备加载态、错误提示、复制按钮
6. API Key 不出现在浏览器 Network/JS bundle 中

### 补充（进阶）
1. 流式输出可开启/关闭，失败自动回退
2. 导出支持 .txt/.md/.pdf，文件编码与排版正确
3. 模板/场景可一键应用并影响输出
4. 多轮对话上下文保留，续写正常
5. 输出区可编辑并保存版本，恢复正常
6. 收藏/历史可新增、查看、删除、清空
7. 内容长度设置生效，超限有提示或截断

---

## 12. 里程碑（建议）
- D1：页面结构 + 表单 + 输出区（静态）
- D2：API Route + OpenRouter 调通
- D3：状态/错误/复制/偏好保存
- D4：响应式与文案打磨
- D5：流式输出 + 容错回退
- D6：导出（TXT/MD/PDF）
- D7：模板/场景 + 内容长度设置
- D8：多轮对话/编辑/收藏/历史

---

## 13. 风险与备选方案
- 免费模型可能限流/不稳定：友好提示 + 支持重试；后续扩展更多模型
- 输出质量波动：后续加入"写作类型模板"（小红书/公众号/论文摘要等）
- token 超限：限制输入长度 + max_tokens；必要时截断描述
- 流式兼容性：SSE/流式在部分浏览器或代理受限，需回退策略
- 本地存储：localStorage 容量与隐私风险，考虑导出与清理
- 文件导出：编码/换行差异；PDF/Word 依赖第三方库稳定性
- 多轮上下文：上下文过长导致费用与延迟，需摘要与窗口管理
